"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}self.PUSHOWL_SERVICE_WORKER_VERSION="2.0";var ErrorHelper=function(){function t(t){t=t||{},t.poServiceWorkerVersion=self.PUSHOWL_SERVICE_WORKER_VERSION;var e=(new Date).toISOString().split(".")[0];return{event_id:function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}(),logger:"cdn-service-worker",platform:"javascript",timestamp:e,extra:t}}function e(t){return fetch(o,{method:"post",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}function n(t){var e=t.stack||"",n=e.split("\n").map(function(t){return t.trim()}),i=n.filter(function(t){return t.startsWith("at")}),r=i.map(function(t){var e="",n=0,i=0,r="",a=t.split(/[ ]+/);if("at"===a[0].trim()&&a.length>1){var o="";a.length>2?(e=a[1],o=a[2]):o=a[1],o=o.replace("(","").replace(")","");var c=o.split(":");c.length>1&&(n=c[c.length-1],i=c[c.length-2],r=c.slice(0,c.length-2).join(":"))}return{in_app:!0,function:e,colno:Number(n)||n,lineno:Number(i)||i,filename:r}});return r.reverse(),{values:[{type:t.name||"Error",value:t.message||String(t),stacktrace:{frames:r}}]}}function i(n,i){var r=t(i);return r.message=n,e(r)}function r(i,r){r=r||{},r.errorDump={str:String(i),stack:i&&i.stack};var a=t(r);return a.exception=n(i),e(a)}function a(t){function e(e){if(!e||!e.waitUntil)throw new Error("withErrorReporting should only be used for handlers that receive ExtendableEvent");try{return t(e)}catch(t){var n=r(t,{eventData:e&&e.data&&e.data.json()});e.waitUntil(n)}}return e}var o="https://sentry.io/api/1891871/store/?sentry_version=7&sentry_key=0df575aa94e3419782416c33a46d9dd7";return{log:i,logException:r,withErrorReporting:a}}();!function(){function t(t){if(!t.data)throw new Error("Empty event data.");var e=i.processPush(t);t.waitUntil(e)}var e=console,n=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"payloadTransformation",value:function(t){var e=t.title,n=[],i=t.actions;if(i)for(var r=0;r<i.length;r++){var a={action:"action"+r,title:i[r].title};n.push(a)}var o=!("require_interaction"in t)||t.require_interaction;return{title:e,config:{body:t.description||"",icon:t.icon,image:t.image,tag:t.tag||t.id,actions:n,requireInteraction:o,data:t}}}},{key:"processPush",value:function(t){this.payload=t.data.json().data;var e=this.payloadTransformation(this.payload),n=e.title,i=e.config,r=this.displayNotification(n,i),a=this.payload.delivery_acknowledgement_url,o=this.update(a);return Promise.all([o,r])}},{key:"displayNotification",value:function(t,e){return self.registration.showNotification(t,e)}},{key:"update",value:function(e){var n={version:t.version};return fetch(e,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})}},{key:"openLink",value:function(t){t&&clients.matchAll({type:"window"}).then(function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.url===t&&"focus"in i)return i.focus()}if(clients.openWindow)return clients.openWindow(t)})}}],[{key:"version",get:function(){return self.PUSHOWL_SERVICE_WORKER_VERSION}}]),t}(),i=new n;self.addEventListener("install",function(t){t.waitUntil(self.skipWaiting())}),self.addEventListener("activate",function(t){t.waitUntil(self.clients.claim())}),self.addEventListener("push",ErrorHelper.withErrorReporting(t)),self.addEventListener("notificationclick",function(t){var e=t.notification.data,n=e.redirect_url,r=e.click_acknowledgement_url,a="body";t.action&&(t.action.includes("action0")?(n=e.actions[0].redirect_url,a="cta1"):t.action.includes("action1")&&(n=e.actions[1].redirect_url,a="cta2"));var o=new Promise(function(e,r){t.notification.close(),i.openLink(n),e()});r+="&clicked_component="+a;var c=Promise.all([o,i.update(r)]);t.waitUntil(c)}),self.addEventListener("message",function(t){var e=i.payloadTransformation(t.data),n=e.title,r=e.config;t.waitUntil(i.displayNotification(n,r))}),self.addEventListener("notificationclose",function(t){t.waitUntil(new Promise(function(e,n){var r=t.notification,a=r.data,o=a.close_acknowledgement_url;i.update(o).then(function(){e()}).catch(function(){})}))}),self.addEventListener("error",function(t){ErrorHelper.logException(t.error),e.error(t.filename,t.lineno,t.colno,t.message)}),"amp-demo-shop"===new URL(self.location).searchParams.get("subdomain")&&importScripts("https://api.shopsheriff.com/v2/integrations/pushowl")}();
